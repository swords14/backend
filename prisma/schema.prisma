generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 Int                @id @default(autoincrement())
  email              String             @unique
  nome               String
  password           String
  avatarUrl          String?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  roleId             Int
  status             String             @default("Ativo")
  isTwoFactorEnabled Boolean            @default(false)
  twoFactorSecret    String?
  auditLogs          AuditLog[]
  CommunicationLog   CommunicationLog[]
  DashboardLayouts   DashboardLayout?
  EventStaff         EventStaff[]
  LayoutTemplate     LayoutTemplate[]
  tasks              Task[]
  role               Role               @relation(fields: [roleId], references: [id])
}

model Role {
  id          Int          @id @default(autoincrement())
  name        String       @unique
  users       User[]
  permissions Permission[] @relation("PermissionToRole")
}

model Permission {
  id      Int    @id @default(autoincrement())
  action  String
  subject String
  roles   Role[] @relation("PermissionToRole")

  @@unique([action, subject])
}

model Client {
  id                  Int                @id @default(autoincrement())
  nome                String
  email               String             @unique
  telefone            String?
  tipo                String?
  cnpj                String?            @unique
  endereco            String?
  cidade              String?
  notas               String?
  tags                String[]
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt
  cep                 String?
  dataAniversario     DateTime?
  dataFundacaoEmpresa DateTime?
  estado              String?
  inscricaoEstadual   String?
  origemCliente       String?
  preferenciasEvento  String?
  ramoAtividade       String?
  cpf                 String?            @unique
  status              String?            @default("Lead")
  budgets             Budget[]
  contacts            ClientContact[]
  communicationLogs   CommunicationLog[]
  contracts           Contract[]
  events              Event[]
  tasks               Task[]
  transactions        Transaction[]
}

model ClientContact {
  id          Int     @id @default(autoincrement())
  nome        String
  cargo       String?
  email       String?
  telefone    String?
  isPrincipal Boolean @default(false)
  clientId    Int
  client      Client  @relation(fields: [clientId], references: [id], onDelete: Cascade)
}

model CommunicationLog {
  id        Int      @id @default(autoincrement())
  type      String
  subject   String
  notes     String
  createdAt DateTime @default(now())
  clientId  Int
  userId    Int
  client    Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id])
}

model Event {
  id                   String        @id @default(uuid())
  title                String
  startDate            DateTime
  endDate              DateTime?
  convidados           Int
  valorTotal           Float
  status               String
  observacoes          String?
  createdAt            DateTime      @default(now())
  clientId             Int
  eventContactEmail    String?
  eventContactName     String?
  eventContactPhone    String?
  eventTheme           String?
  eventType            String?
  localCEP             String?
  localCidade          String?
  localEndereco        String?
  localEstado          String?
  localNome            String?
  setupDate            DateTime?
  setupTimeEnd         String?
  setupTimeStart       String?
  specificRequirements String?
  teardownDate         DateTime?
  teardownTimeEnd      String?
  teardownTimeStart    String?
  contract             Contract?
  client               Client        @relation(fields: [clientId], references: [id], onDelete: Cascade)
  eventItems           EventItem[]
  staff                EventStaff[]
  eventTasks           EventTask[]
  feedbacks            Feedback?
  tasks                Task[]
  transactions         Transaction[]
}

model Budget {
  id                     String       @id @default(uuid())
  status                 String
  validade               DateTime
  valorTotal             Float
  createdAt              DateTime     @default(now())
  clientId               Int
  convidados             Int?
  desconto               Float?       @default(0)
  eventDate              DateTime?
  eventName              String?
  observacoes            String?
  taxaServico            Float?       @default(10)
  codigoOrcamento        String?      @unique
  condicoesPagamento     String?
  dataEnvio              DateTime?
  horarioFim             String?
  horarioInicio          String?
  localEventoCEP         String?
  localEventoCidade      String?
  localEventoEndereco    String?
  localEventoEstado      String?
  localEventoNome        String?
  observacoesFinanceiras String?
  restricoesAlimentares  String?
  tipoCozinha            String?
  versao                 String?      @default("1.0")
  client                 Client       @relation(fields: [clientId], references: [id], onDelete: Cascade)
  items                  BudgetItem[]
  contract               Contract?
}

model BudgetItem {
  id            Int     @id @default(autoincrement())
  descricao     String
  quantidade    Float
  valorUnitario Float
  budgetId      String
  unidade       String?
  budget        Budget  @relation(fields: [budgetId], references: [id], onDelete: Cascade)
}

model Service {
  id        Int      @id @default(autoincrement())
  nome      String   @unique
  valor     Float
  unidade   String
  createdAt DateTime @default(now())
}

model Contract {
  id             String    @id @default(uuid())
  status         String
  dataAssinatura DateTime?
  createdAt      DateTime  @default(now())
  eventId        String?   @unique
  arquivoUrl     String?
  budgetId       String    @unique
  clientId       Int
  codigoContrato String    @unique
  dataEmissao    DateTime  @default(now())
  observacoes    String?
  updatedAt      DateTime  @updatedAt
  valor          Float
  conteudo       String?
  budget         Budget    @relation(fields: [budgetId], references: [id])
  client         Client    @relation(fields: [clientId], references: [id])
  event          Event?    @relation(fields: [eventId], references: [id])
}

model Transaction {
  id              String    @id @default(uuid())
  descricao       String
  valor           Float
  tipo            String
  data            DateTime
  status          String
  metodoPagamento String
  dataVencimento  DateTime?
  clientId        Int?
  supplierId      Int?
  eventId         String?
  categoria       String?
  linkComprovante String?
  numeroDocumento String?
  observacoes     String?
  client          Client?   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  event           Event?    @relation(fields: [eventId], references: [id])
  supplier        Supplier? @relation(fields: [supplierId], references: [id])
}

model Supplier {
  id                  Int             @id @default(autoincrement())
  nome                String
  categoria           String
  contato             String?
  telefone            String?
  email               String?
  rating              Int             @default(0)
  status              String          @default("Ativo")
  notas               String?
  agencia             String?
  banco               String?
  cargoContato        String?
  cep                 String?
  chavePix            String?
  cidade              String?
  cnpj                String?         @unique
  conta               String?
  dataUltimoContato   DateTime?
  emailAlternativo    String?
  endereco            String?
  estado              String?
  inscricaoEstadual   String?
  servicosOferecidos  String[]
  telefoneAlternativo String?
  termosPagamento     String?
  inventoryItems      InventoryItem[]
  transactions        Transaction[]
}

model InventoryItem {
  id            Int                 @id @default(autoincrement())
  nome          String              @unique
  categoria     String
  imageUrl      String?
  quantidade    Int
  estoqueMinimo Int
  valorUnitario Float
  supplierId    Int?
  description   String?
  sku           String?             @unique
  eventItems    EventItem[]
  supplier      Supplier?           @relation(fields: [supplierId], references: [id])
  movements     InventoryMovement[]
}

model InventoryMovement {
  id         Int           @id @default(autoincrement())
  tipo       String
  quantidade Int
  obs        String?
  createdAt  DateTime      @default(now())
  itemId     Int
  item       InventoryItem @relation(fields: [itemId], references: [id], onDelete: Cascade)
}

model EventTask {
  id        Int       @id @default(autoincrement())
  descricao String
  concluida Boolean   @default(false)
  dueDate   DateTime?
  eventId   String
  event     Event     @relation(fields: [eventId], references: [id], onDelete: Cascade)
}

model EventStaff {
  eventId String
  userId  Int
  event   Event  @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user    User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([eventId, userId])
}

model Feedback {
  id                 String  @id @default(uuid())
  notasJson          String
  sugestao           String?
  autorizaDepoimento Boolean @default(false)
  eventId            String  @unique
  event              Event   @relation(fields: [eventId], references: [id], onDelete: Cascade)
}

model EventItem {
  id                  Int           @id @default(autoincrement())
  quantidadeReservada Int
  eventId             String
  inventoryItemId     Int
  event               Event         @relation(fields: [eventId], references: [id], onDelete: Cascade)
  inventoryItem       InventoryItem @relation(fields: [inventoryItemId], references: [id], onDelete: Cascade)

  @@unique([eventId, inventoryItemId])
}

model AuditLog {
  id         Int      @id @default(autoincrement())
  action     String
  entityType String
  entityId   String
  details    Json?
  createdAt  DateTime @default(now())
  userId     Int
  user       User     @relation(fields: [userId], references: [id])
}

model Company {
  id               Int      @id @default(1)
  nomeFantasia     String?
  razaoSocial      String?
  cnpj             String?  @unique
  endereco         String?
  cidade           String?
  estado           String?
  cep              String?
  telefone         String?
  email            String?
  logoUrl          String?
  banco            String?
  agencia          String?
  conta            String?
  chavePix         String?
  regimeTributario String?
  updatedAt        DateTime @updatedAt
}

model DocumentTemplate {
  id        Int      @id @default(autoincrement())
  nome      String   @unique
  tipo      String
  conteudo  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model DashboardLayout {
  id        Int      @id @default(autoincrement())
  userId    Int      @unique
  layout    Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model LayoutTemplate {
  id         String   @id @default(uuid())
  name       String
  layoutJson String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  authorId   Int?
  author     User?    @relation(fields: [authorId], references: [id])
}

model Task {
  id           Int       @id @default(autoincrement())
  title        String
  description  String?
  status       String    @default("Pendente")
  priority     String    @default("Normal")
  dueDate      DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  assignedToId Int
  clientId     Int?
  eventId      String?
  tags         String[]
  subTasks     SubTask[]
  assignedTo   User      @relation(fields: [assignedToId], references: [id])
  client       Client?   @relation(fields: [clientId], references: [id])
  event        Event?    @relation(fields: [eventId], references: [id])
}

model SubTask {
  id     Int     @id @default(autoincrement())
  text   String
  isDone Boolean @default(false)
  taskId Int
  task   Task    @relation(fields: [taskId], references: [id], onDelete: Cascade)
}
